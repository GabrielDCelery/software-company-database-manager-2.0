var DatabaseApp=angular.module("DatabaseApp",["ngRoute","ngCookies","checklist-model","AuthCtrl","AuthFactory","CompaniesCtrl","DatabaseFactory","MailingCtrl","MailingFactory","SubMenuFactory","FilteredSearchFactory","FormatDataFactory","AlertsFactory"]);DatabaseApp.config(["$routeProvider","$locationProvider",function(t,a){t.when("/companies",{templateUrl:"templates/companies/_companies_main.html",controller:"CompaniesCtrl"}).when("/mailing",{templateUrl:"templates/mailing/_mailing_main.html",controller:"MailingCtrl"}).otherwise({redirectTo:"/"})}]);var AuthCtrl=angular.module("AuthCtrl",[]);AuthCtrl.controller("AuthCtrl",["$scope","AuthFactory",function(t,a){function e(e,n){a.login(e,n,function(o){o.data?(t.loggedIn=!0,a.setLoginCookie(e,n)):t.loggedIn=!1})}function n(){t.loggedIn=!1,a.clearLoginCookie()}function o(t){a.getLoginCookie(t)}t.loggedIn=!1,t.login=e,t.logout=n,o(e)}]);var AuthFactory=angular.module("AuthFactory",[]);AuthFactory.factory("AuthFactory",["$http","$cookies",function(t,a){function e(a,e,n){t.post("php/login.php",{username:a,password:e}).success(n)}function n(t,e){var n=i.encode(t),o=i.encode(e),r={username:n,password:o};a.putObject("userCookie",r)}function o(){a.remove("userCookie")}function r(t){var e=a.getObject("userCookie");if(e){var n=i.decode(e.username),o=i.decode(e.password);t(n,o)}}var i={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var a,e,n,o,r,i="",c="",s="",l=0;do a=t.charCodeAt(l++),e=t.charCodeAt(l++),c=t.charCodeAt(l++),n=a>>2,o=(3&a)<<4|e>>4,r=(15&e)<<2|c>>6,s=63&c,isNaN(e)?r=s=64:isNaN(c)&&(s=64),i=i+this.keyStr.charAt(n)+this.keyStr.charAt(o)+this.keyStr.charAt(r)+this.keyStr.charAt(s),a=e=c="",n=o=r=s="";while(l<t.length);return i},decode:function(t){var a,e,n,o,r,i="",c="",s="",l=0,u=/[^A-Za-z0-9\+\/\=]/g;u.exec(t)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=this.keyStr.indexOf(t.charAt(l++)),o=this.keyStr.indexOf(t.charAt(l++)),r=this.keyStr.indexOf(t.charAt(l++)),s=this.keyStr.indexOf(t.charAt(l++)),a=n<<2|o>>4,e=(15&o)<<4|r>>2,c=(3&r)<<6|s,i+=String.fromCharCode(a),64!=r&&(i+=String.fromCharCode(e)),64!=s&&(i+=String.fromCharCode(c)),a=e=c="",n=o=r=s="";while(l<t.length);return i}};return{login:e,setLoginCookie:n,clearLoginCookie:o,getLoginCookie:r}}]);var CompaniesCtrl=angular.module("CompaniesCtrl",[]);CompaniesCtrl.controller("CompaniesCtrl",["$scope","$http","subMenu","filteredSearch","FormatData","Alerts","Database",function(t,a,e,n,o,r,i){function c(a){r.isAnythingSelected(t.selectedCompanies.id,function(t){i.getDetailedCompaniesData(t,function(t){var e=new o.DataObject(t);e.addColourCoding().formatPostalServiceToString().formatDateCorrectly(),a(e.data)})})}function s(t,a){var e=[];e.push(t);var n=new o.DataObject(e);n.formatPostalServiceToBoolean(),a(n.data)}function l(a){n.filterCompanyNames(a,function(a){t.filteredListOfCompanies=a})}function u(a){t.form.searchCompany.companyName=a,t.filteredListOfCompanies=[]}function d(a){n.filterManagerNames(a,function(a){t.filteredListOfManagers=a})}function f(a){t.form.searchCompany.managerName=a,t.filteredListOfManagers=[]}function p(a){t.filteredListOfCompanies=[],t.filteredListOfManagers=[],i.getShortCompaniesData(a,function(a){var e=new o.DataObject(a);e.addColourCoding(),t.companiesShortList=e.data})}function m(){c(function(a){t.companiesDetailedEdit=a})}function h(t){s(t,function(t){i.overWriteCompanyData(t,function(t){r.checkSuccess(t),m()})})}function g(){r.isAnythingSelected(t.selectedCompanies.id,function(a){r.confirmChange(a,function(a){i.changeContractStatus(a,function(a){r.checkSuccess(a),t.form.searchCompany.validContract&&t.form.searchCompany.expiredContract||(t.form.searchCompany.validContract=!t.form.searchCompany.validContract,t.form.searchCompany.expiredContract=!t.form.searchCompany.expiredContract),p(t.form.searchCompany)})})})}function C(){c(function(a){t.companiesDetailedExtend=a})}function y(t){s(t,function(t){i.extendContract(t,function(t){r.checkSuccess(t)})})}function v(a){e.displayContent(t.display.form,a,function(a){t.display.form=a})}function _(){t.display=angular.copy(F)}t.display={form:{searchCompany:!1,sendEmail:!1,showDetails:!1,extendContract:!1,addNewCompany:!1},data:{"short":!0,detailed:!0}},t.form={searchCompany:{companyName:"",managerName:"",validContract:!0,expiredContract:!1,startingDate:null,endingDate:null,lastContractOnly:!0}},t.filteredListOfCompanies=[],t.filteredListOfManagers=[],t.companiesShortList=[],t.sortField="company_name",t.reverseSortField=!1,t.companiesDetailedEdit=[],t.companiesDetailedExtend=[],t.selectedCompanies={id:[],allChecked:!1};var F=angular.copy(t.display);t.menu=v,t.reset=_,t.filterListOfCompanyNames=l,t.filterListOfManagerNames=d,t.insertCompanyNameToInputField=u,t.insertManagerNameToInputField=f,t.formSearchCompaniesShortList=p,t.formGetDetailedCompaniesData=m,t.overwriteCompanyData=h,t.formChangeContractStatus=g,t.formExtendContract=C,t.addExtendedContract=y}]);var DatabaseFactory=angular.module("DatabaseFactory",[]);DatabaseFactory.factory("Database",["$http",function(t){function a(a,e){t.post("php/companies/form_search_companies.php",a).success(function(t){e(t)})}function e(a,e){t.post("php/companies/form_companies_detailed.php",a).success(function(t){e(t)})}function n(a,e){t.post("php/companies/form_companies_overwrite_company_data.php",a).success(function(t){e(t)})}function o(a,e){t.post("php/companies/form_companies_change_contract_status.php",a).success(function(t){e(t)})}function r(a,e){t.post("php/companies/form_companies_extend_contract.php",a).success(function(t){e(t)})}return{getShortCompaniesData:a,getDetailedCompaniesData:e,overWriteCompanyData:n,changeContractStatus:o,extendContract:r}}]);var MailingCtrl=angular.module("MailingCtrl",[]);MailingCtrl.controller("MailingCtrl",["$scope","subMenu",function(t,a){function e(e){a.displayContent(t.display.form,e,function(a){t.display.form=a})}function n(){t.display=angular.copy(o)}t.display={form:{searchMails:!1,forwardMails:!1,editMails:!1,addNewMails:!1}};var o=angular.copy(t.display);t.menu=e,t.reset=n}]);var MailingFactory=angular.module("MailingFactory",[]);MailingFactory.factory("MailingFactory",["$http",function(t){}]);var SubMenuFactory=angular.module("SubMenuFactory",[]);SubMenuFactory.factory("subMenu",[function(){function t(t,a,e){for(var n in t)n==a?t[n]=!0:t[n]=!1;e(t)}return{displayContent:t}}]);var FilteredSearchFactory=angular.module("FilteredSearchFactory",[]);FilteredSearchFactory.factory("filteredSearch",["$http",function(t){function a(a){i?a(i):t.get("php/companies/fetch_company_names.php").success(function(t){i=t,a(t)})}function e(a){c?a(c):t.get("php/companies/fetch_manager_names.php").success(function(t){c=t,a(t)})}function n(t,a){var e=a,n=[];if(0!==t.length)for(var o=0;o<e.length;o++)e[o].substring(0,t.length).toLowerCase()===t.toLowerCase()&&n.push(e[o]);return n}function o(t,e){a(function(a){e(n(t,a))})}function r(t,a){e(function(e){a(n(t,e))})}var i,c;return{filterCompanyNames:o,filterManagerNames:r}}]);var FormatDataFactory=angular.module("FormatDataFactory",[]);FormatDataFactory.factory("FormatData",[function(){function t(t){var a=new Date(t);return a}function a(t){this.data=t}return a.prototype.addColourCoding=function(){return this.data.map(function(t){1!=t.contract_status||""!=t.postal_number&&null!=t.postal_number?1==t.contract_status?t.css_color="green":t.css_color="red":t.css_color="yellow"}),this},a.prototype.formatDateCorrectly=function(){return this.data.map(function(a){"1970-01-01"==a.starting_date||"0000-00-00"==a.starting_date||null==a.starting_date?a.starting_date=null:a.starting_date=t(a.starting_date),"1970-01-01"==a.ending_date||"0000-00-00"==a.ending_date||null==a.ending_date?a.ending_date=null:a.ending_date=t(a.ending_date),"1970-01-01"==a.transfer_date||"0000-00-00"==a.transfer_date||null==a.transfer_date?a.transfer_date=null:a.transfer_date=t(a.transfer_date),"1970-01-01"==a.invoice_date||"0000-00-00"==a.invoice_date||null==a.invoice_date?a.invoice_date=null:a.invoice_date=t(a.invoice_date)}),this},a.prototype.formatPostalServiceToString=function(){return this.data.map(function(t){1==t.postal_service?t.postal_service="igen":t.postal_service="nem"}),this},a.prototype.formatPostalServiceToBoolean=function(){return this.data.map(function(t){"igen"==t.postal_service?t.postal_service=1:t.postal_service=0}),this},{DataObject:a}}]);var AlertsFactory=angular.module("AlertsFactory",[]);AlertsFactory.factory("Alerts",[function(){function t(t,a){0==t.length?alert("Nem választottál ki semmit!"):a(t)}function a(t){1==t?alert("Változások sikeresen végrehajtva!"):alert("Nem sikerült a kért változatásokat végrehajtani!")}function e(t,a){var e=confirm("Végre akarod hajtani a kívánt változtatásokat?");e&&a(t)}return{isAnythingSelected:t,checkSuccess:a,confirmChange:e}}]);
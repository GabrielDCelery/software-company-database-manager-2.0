var DatabaseApp=angular.module("DatabaseApp",["ngRoute","ngCookies","checklist-model","AuthCtrl","AuthFactory","CompaniesCtrl","CompaniesFactory","MailingCtrl","MailingFactory","SubMenuFactory","FilteredSearchFactory"]);DatabaseApp.config(["$routeProvider","$locationProvider",function(t,e){t.when("/companies",{templateUrl:"templates/companies/_companies_main.html",controller:"CompaniesCtrl"}).when("/mailing",{templateUrl:"templates/mailing/_mailing_main.html",controller:"MailingCtrl"}).otherwise({redirectTo:"/"})}]);var AuthCtrl=angular.module("AuthCtrl",[]);AuthCtrl.controller("AuthCtrl",["$scope","AuthFactory",function(t,e){function a(a,n){e.login(a,n,function(o){o.data?(t.loggedIn=!0,e.setLoginCookie(a,n)):t.loggedIn=!1})}function n(){t.loggedIn=!1,e.clearLoginCookie()}function o(t){e.getLoginCookie(t)}t.loggedIn=!1,t.login=a,t.logout=n,o(a)}]);var AuthFactory=angular.module("AuthFactory",[]);AuthFactory.factory("AuthFactory",["$http","$cookies",function(t,e){function a(e,a,n){t.post("php/login.php",{username:e,password:a}).success(n)}function n(t,a){var n=i.encode(t),o=i.encode(a),r={username:n,password:o};e.putObject("userCookie",r)}function o(){e.remove("userCookie")}function r(t){var a=e.getObject("userCookie");if(a){var n=i.decode(a.username),o=i.decode(a.password);t(n,o)}}var i={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,a,n,o,r,i="",s="",c="",l=0;do e=t.charCodeAt(l++),a=t.charCodeAt(l++),s=t.charCodeAt(l++),n=e>>2,o=(3&e)<<4|a>>4,r=(15&a)<<2|s>>6,c=63&s,isNaN(a)?r=c=64:isNaN(s)&&(c=64),i=i+this.keyStr.charAt(n)+this.keyStr.charAt(o)+this.keyStr.charAt(r)+this.keyStr.charAt(c),e=a=s="",n=o=r=c="";while(l<t.length);return i},decode:function(t){var e,a,n,o,r,i="",s="",c="",l=0,u=/[^A-Za-z0-9\+\/\=]/g;u.exec(t)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=this.keyStr.indexOf(t.charAt(l++)),o=this.keyStr.indexOf(t.charAt(l++)),r=this.keyStr.indexOf(t.charAt(l++)),c=this.keyStr.indexOf(t.charAt(l++)),e=n<<2|o>>4,a=(15&o)<<4|r>>2,s=(3&r)<<6|c,i+=String.fromCharCode(e),64!=r&&(i+=String.fromCharCode(a)),64!=c&&(i+=String.fromCharCode(s)),e=a=s="",n=o=r=c="";while(l<t.length);return i}};return{login:a,setLoginCookie:n,clearLoginCookie:o,getLoginCookie:r}}]);var CompaniesCtrl=angular.module("CompaniesCtrl",[]);CompaniesCtrl.controller("CompaniesCtrl",["$scope","$http","subMenu","filteredSearch","CompaniesFunctions",function(t,e,a,n,o){function r(e){n.filterCompanyNames(e,function(e){t.filteredListOfCompanies=e})}function i(e){t.form.searchCompany.companyName=e,t.filteredListOfCompanies=[]}function s(e){n.filterManagerNames(e,function(e){t.filteredListOfManagers=e})}function c(e){t.form.searchCompany.managerName=e,t.filteredListOfManagers=[]}function l(){t.filteredListOfCompanies=[],t.filteredListOfManagers=[];var e=t.form.searchCompany;o.getShortCompaniesData(e,function(e){var a=new o.DataFormatter(e);a.addColourCoding(),t.companiesShortList=a.data})}function u(){if(0==t.selectedCompanies.id.length)alert("Nem választottál ki semmit!");else{var e=t.selectedCompanies;o.getDetailedCompaniesData(e,function(e){var a=new o.DataFormatter(e);a.addColourCoding().formatPostalServiceToString().formatDateCorrectly(),t.companiesDetailed=a.data})}}function d(t){var e=[];e.push(t);var a=new o.DataFormatter(e);a.formatPostalServiceToBoolean(),o.overWriteCompanyData(a.data,function(t){alert("Adatok sikeresen felülírva!"),u()})}function p(e){a.displayContent(t.display.form,e,function(e){t.display.form=e})}function m(){t.display=angular.copy(f)}t.display={form:{searchCompany:!1,sendEmail:!1,showDetails:!1,extendContract:!1,addNewCompany:!1},data:{"short":!0,detailed:!0}},t.form={searchCompany:{companyName:"",managerName:"",validContract:!0,expiredContract:!1,startingDate:null,endingDate:null,lastContractOnly:!0}},t.filteredListOfCompanies=[],t.filteredListOfManagers=[],t.companiesShortList=[],t.sortField="company_name",t.reverseSortField=!1,t.companiesDetailed=[],t.selectedCompanies={id:[],allChecked:!1};var f=angular.copy(t.display);t.menu=p,t.reset=m,t.filterListOfCompanyNames=r,t.filterListOfManagerNames=s,t.insertCompanyNameToInputField=i,t.insertManagerNameToInputField=c,t.formSearchCompaniesShortList=l,t.formGetDetailedCompaniesData=u,t.overwriteCompanyData=d}]);var CompaniesFactory=angular.module("CompaniesFactory",[]);CompaniesFactory.factory("CompaniesFunctions",["$http",function(t){function e(e,a){t.post("php/companies/form_search_companies.php",e).success(function(t){a(t)})}function a(e,a){t.post("php/companies/form_companies_detailed.php",e).success(function(t){a(t)})}function n(e,a){t.post("php/companies/form_companies_overwrite_company_data.php",e).success(function(t){a(t)})}function o(t){var e=new Date(t);return e}function r(t){this.data=t}return r.prototype.addColourCoding=function(){return this.data.map(function(t){1!=t.contract_status||""!=t.postal_number&&null!=t.postal_number?1==t.contract_status?t.css_color="green":t.css_color="red":t.css_color="yellow"}),this},r.prototype.formatDateCorrectly=function(){return this.data.map(function(t){"1970-01-01"==t.starting_date||"0000-00-00"==t.starting_date||null==t.starting_date?t.starting_date=null:t.starting_date=o(t.starting_date),"1970-01-01"==t.ending_date||"0000-00-00"==t.ending_date||null==t.ending_date?t.ending_date=null:t.ending_date=o(t.ending_date),"1970-01-01"==t.transfer_date||"0000-00-00"==t.transfer_date||null==t.transfer_date?t.transfer_date=null:t.transfer_date=o(t.transfer_date),"1970-01-01"==t.invoice_date||"0000-00-00"==t.invoice_date||null==t.invoice_date?t.invoice_date=null:t.invoice_date=o(t.invoice_date)}),this},r.prototype.formatPostalServiceToString=function(){return this.data.map(function(t){1==t.postal_service?t.postal_service="igen":t.postal_service="nem"}),this},r.prototype.formatPostalServiceToBoolean=function(){return this.data.map(function(t){"igen"==t.postal_service?t.postal_service=1:t.postal_service=0}),this},{DataFormatter:r,getShortCompaniesData:e,getDetailedCompaniesData:a,overWriteCompanyData:n}}]);var MailingCtrl=angular.module("MailingCtrl",[]);MailingCtrl.controller("MailingCtrl",["$scope","subMenu",function(t,e){function a(a){e.displayContent(t.display.form,a,function(e){t.display.form=e})}function n(){t.display=angular.copy(o)}t.display={form:{searchMails:!1,forwardMails:!1,editMails:!1,addNewMails:!1}};var o=angular.copy(t.display);t.menu=a,t.reset=n}]);var MailingFactory=angular.module("MailingFactory",[]);MailingFactory.factory("MailingFactory",["$http",function(t){}]);var SubMenuFactory=angular.module("SubMenuFactory",[]);SubMenuFactory.factory("subMenu",[function(){function t(t,e,a){for(var n in t)n==e?t[n]=!0:t[n]=!1;a(t)}return{displayContent:t}}]);var FilteredSearchFactory=angular.module("FilteredSearchFactory",[]);FilteredSearchFactory.factory("filteredSearch",["$http",function(t){function e(e){i?e(i):t.get("php/companies/fetch_company_names.php").success(function(t){i=t,e(t)})}function a(e){s?e(s):t.get("php/companies/fetch_manager_names.php").success(function(t){s=t,e(t)})}function n(t,e){var a=e,n=[];if(0!==t.length)for(var o=0;o<a.length;o++)a[o].substring(0,t.length).toLowerCase()===t.toLowerCase()&&n.push(a[o]);return n}function o(t,a){e(function(e){a(n(t,e))})}function r(t,e){a(function(a){e(n(t,a))})}var i,s;return{filterCompanyNames:o,filterManagerNames:r}}]);
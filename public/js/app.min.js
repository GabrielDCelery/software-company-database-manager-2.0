var DatabaseApp=angular.module("DatabaseApp",["ngRoute","ngCookies","AuthCtrl","AuthFactory","CompaniesCtrl","CompaniesFactory","MailingCtrl","MailingFactory","SubMenuFactory","FilteredSearchFactory"]);DatabaseApp.config(["$routeProvider","$locationProvider",function(e,a){e.when("/companies",{templateUrl:"templates/companies/_companies_main.html",controller:"CompaniesCtrl"}).when("/mailing",{templateUrl:"templates/mailing/_mailing_main.html",controller:"MailingCtrl"}).otherwise({redirectTo:"/"})}]);var AuthCtrl=angular.module("AuthCtrl",[]);AuthCtrl.controller("AuthCtrl",["$scope","AuthFactory",function(e,a){function n(n,t){a.login(n,t,function(o){o.data?(e.loggedIn=!0,a.setLoginCookie(n,t)):e.loggedIn=!1})}function t(){e.loggedIn=!1,a.clearLoginCookie()}function o(e){a.getLoginCookie(e)}e.loggedIn=!1,e.login=n,e.logout=t,o(n)}]);var AuthFactory=angular.module("AuthFactory",[]);AuthFactory.factory("AuthFactory",["$http","$cookies",function(e,a){function n(a,n,t){e.post("php/login.php",{username:a,password:n}).success(t)}function t(e,n){var t=i.encode(e),o=i.encode(n),r={username:t,password:o};a.putObject("userCookie",r)}function o(){a.remove("userCookie")}function r(e){var n=a.getObject("userCookie");if(n){var t=i.decode(n.username),o=i.decode(n.password);e(t,o)}}var i={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var a,n,t,o,r,i="",c="",s="",l=0;do a=e.charCodeAt(l++),n=e.charCodeAt(l++),c=e.charCodeAt(l++),t=a>>2,o=(3&a)<<4|n>>4,r=(15&n)<<2|c>>6,s=63&c,isNaN(n)?r=s=64:isNaN(c)&&(s=64),i=i+this.keyStr.charAt(t)+this.keyStr.charAt(o)+this.keyStr.charAt(r)+this.keyStr.charAt(s),a=n=c="",t=o=r=s="";while(l<e.length);return i},decode:function(e){var a,n,t,o,r,i="",c="",s="",l=0,u=/[^A-Za-z0-9\+\/\=]/g;u.exec(e)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do t=this.keyStr.indexOf(e.charAt(l++)),o=this.keyStr.indexOf(e.charAt(l++)),r=this.keyStr.indexOf(e.charAt(l++)),s=this.keyStr.indexOf(e.charAt(l++)),a=t<<2|o>>4,n=(15&o)<<4|r>>2,c=(3&r)<<6|s,i+=String.fromCharCode(a),64!=r&&(i+=String.fromCharCode(n)),64!=s&&(i+=String.fromCharCode(c)),a=n=c="",t=o=r=s="";while(l<e.length);return i}};return{login:n,setLoginCookie:t,clearLoginCookie:o,getLoginCookie:r}}]);var CompaniesCtrl=angular.module("CompaniesCtrl",[]);CompaniesCtrl.controller("CompaniesCtrl",["$scope","$http","subMenu","filteredSearch","CompaniesFunctions",function(e,a,n,t,o){function r(a){t.filterCompanyNames(a,function(a){e.filteredListOfCompanies=a})}function i(a){e.form.searchCompany.companyName=a,e.filteredListOfCompanies=[]}function c(a){t.filterManagerNames(a,function(a){e.filteredListOfManagers=a})}function s(a){e.form.searchCompany.managerName=a,e.filteredListOfManagers=[]}function l(){var a=e.form.searchCompany;o.getCompanies(a,function(a){console.log(a),e.companiesShortList=a})}function u(a){n.displayContent(e.display.form,a,function(a){e.display.form=a})}function p(){e.display=angular.copy(m)}e.display={form:{searchCompany:!1,sendEmail:!1,showDetails:!1,extendContract:!1,addNewCompany:!1}},e.form={searchCompany:{companyName:"",managerName:"",validContract:!0,expiredContract:!1,startingDate:null,endingDate:null,lastContractOnly:!0}},e.filteredListOfCompanies=[],e.filteredListOfManagers=[],e.companiesShortList=[],e.sortField="company_name",e.reverseSortField=!1;var m=angular.copy(e.display);e.menu=u,e.reset=p,e.filterListOfCompanyNames=r,e.filterListOfManagerNames=c,e.insertCompanyNameToInputField=i,e.insertManagerNameToInputField=s,e.formSearchCompaniesShortList=l}]);var CompaniesFactory=angular.module("CompaniesFactory",[]);CompaniesFactory.factory("CompaniesFunctions",["$http",function(e){function a(a,n){e.post("php/companies/form_search_companies.php",a).success(function(e){n(e)})}return{getCompanies:a}}]);var MailingCtrl=angular.module("MailingCtrl",[]);MailingCtrl.controller("MailingCtrl",["$scope","subMenu",function(e,a){function n(n){a.displayContent(e.display.form,n,function(a){e.display.form=a})}function t(){e.display=angular.copy(o)}e.display={form:{searchMails:!1,forwardMails:!1,editMails:!1,addNewMails:!1}};var o=angular.copy(e.display);e.menu=n,e.reset=t}]);var MailingFactory=angular.module("MailingFactory",[]);MailingFactory.factory("MailingFactory",["$http",function(e){}]);var SubMenuFactory=angular.module("SubMenuFactory",[]);SubMenuFactory.factory("subMenu",[function(){function e(e,a,n){for(var t in e)t==a?e[t]=!0:e[t]=!1;n(e)}return{displayContent:e}}]);var FilteredSearchFactory=angular.module("FilteredSearchFactory",[]);FilteredSearchFactory.factory("filteredSearch",["$http",function(e){function a(a){i?a(i):e.get("php/companies/fetch_company_names.php").success(function(e){i=e,a(e)})}function n(a){c?a(c):e.get("php/companies/fetch_manager_names.php").success(function(e){c=e,a(e)})}function t(e,a){var n=a,t=[];if(0!==e.length)for(var o=0;o<n.length;o++)n[o].substring(0,e.length).toLowerCase()===e.toLowerCase()&&t.push(n[o]);return t}function o(e,n){a(function(a){n(t(e,a))})}function r(e,a){n(function(n){a(t(e,n))})}var i,c;return{filterCompanyNames:o,filterManagerNames:r}}]);
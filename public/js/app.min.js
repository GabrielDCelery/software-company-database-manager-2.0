var DatabaseApp=angular.module("DatabaseApp",["ngRoute","ngCookies","checklist-model","AuthCtrl","AuthFactory","CompaniesCtrl","DatabaseFactory","MailingCtrl","MailingFactory","SubMenuFactory","FilteredSearchFactory","FormatDataFactory","AlertsFactory"]);DatabaseApp.config(["$routeProvider","$locationProvider",function(a,t){a.when("/companies",{templateUrl:"templates/companies/_companies_main.html",controller:"CompaniesCtrl"}).when("/mailing",{templateUrl:"templates/mailing/_mailing_main.html",controller:"MailingCtrl"}).otherwise({redirectTo:"/"})}]);var AuthCtrl=angular.module("AuthCtrl",[]);AuthCtrl.controller("AuthCtrl",["$scope","AuthFactory",function(a,t){function e(e,n){t.login(e,n,function(o){o.data?(a.loggedIn=!0,t.setLoginCookie(e,n)):a.loggedIn=!1})}function n(){a.loggedIn=!1,t.clearLoginCookie()}function o(a){t.getLoginCookie(a)}a.loggedIn=!1,a.login=e,a.logout=n,o(e)}]);var AuthFactory=angular.module("AuthFactory",[]);AuthFactory.factory("AuthFactory",["$http","$cookies",function(a,t){function e(t,e,n){a.post("php/login.php",{username:t,password:e}).success(n)}function n(a,e){var n=i.encode(a),o=i.encode(e),r={username:n,password:o};t.putObject("userCookie",r)}function o(){t.remove("userCookie")}function r(a){var e=t.getObject("userCookie");if(e){var n=i.decode(e.username),o=i.decode(e.password);a(n,o)}}var i={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var t,e,n,o,r,i="",c="",s="",d=0;do t=a.charCodeAt(d++),e=a.charCodeAt(d++),c=a.charCodeAt(d++),n=t>>2,o=(3&t)<<4|e>>4,r=(15&e)<<2|c>>6,s=63&c,isNaN(e)?r=s=64:isNaN(c)&&(s=64),i=i+this.keyStr.charAt(n)+this.keyStr.charAt(o)+this.keyStr.charAt(r)+this.keyStr.charAt(s),t=e=c="",n=o=r=s="";while(d<a.length);return i},decode:function(a){var t,e,n,o,r,i="",c="",s="",d=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(a)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=this.keyStr.indexOf(a.charAt(d++)),o=this.keyStr.indexOf(a.charAt(d++)),r=this.keyStr.indexOf(a.charAt(d++)),s=this.keyStr.indexOf(a.charAt(d++)),t=n<<2|o>>4,e=(15&o)<<4|r>>2,c=(3&r)<<6|s,i+=String.fromCharCode(t),64!=r&&(i+=String.fromCharCode(e)),64!=s&&(i+=String.fromCharCode(c)),t=e=c="",n=o=r=s="";while(d<a.length);return i}};return{login:e,setLoginCookie:n,clearLoginCookie:o,getLoginCookie:r}}]);var CompaniesCtrl=angular.module("CompaniesCtrl",[]);CompaniesCtrl.controller("CompaniesCtrl",["$scope","$http","SubMenu","FilteredSearch","FormatData","Alerts","Database",function(a,t,e,n,o,r,i){function c(){a.filteredListOfCompanies=[],a.filteredListOfManagers=[],a.selectedCompanies.id=[],a.selectedCompanies.allChecked=!1,a.display.form.searchCompany=!1,a.display.form.sendEmail=!1,a.display.form.showDetails=!1,a.display.form.extendContract=!1,a.display.form.addNewCompany=!1,a.display.data.list=!0,a.display.data.edit=!1,a.display.data.extend=!1}function s(){a.display.form.searchCompany=!1,a.display.form.sendEmail=!1,a.display.form.showDetails=!1,a.display.form.extendContract=!1,a.display.form.addNewCompany=!1,a.display.data.list=!1,a.display.data.edit=!0,a.display.data.extend=!1}function d(){a.display.form.searchCompany=!1,a.display.form.sendEmail=!1,a.display.form.showDetails=!1,a.display.form.extendContract=!1,a.display.form.addNewCompany=!1,a.display.data.list=!1,a.display.data.edit=!1,a.display.data.extend=!0}function l(t){r.isAnythingSelected(a.selectedCompanies.id,function(a){i.getDetailedCompaniesData(a,function(a){var e=new o.DataObject(a);e.addColourCoding().formatPostalServiceToString().formatDateCorrectly(),t(e.data)})})}function p(a,t){var e=[];e.push(a);var n=new o.DataObject(e);n.formatPostalServiceToBoolean(),t(n.data)}function m(t){n.filterCompanyNames(t,function(t){a.filteredListOfCompanies=t})}function u(t){a.form.searchCompany.companyName=t,a.filteredListOfCompanies=[]}function f(t){n.filterManagerNames(t,function(t){a.filteredListOfManagers=t})}function y(t){a.form.searchCompany.managerName=t,a.filteredListOfManagers=[]}function h(t){i.getShortCompaniesData(t,function(t){var e=new o.DataObject(t);e.addColourCoding(),a.companyDataList=e.data,c()})}function g(){l(function(t){a.companyDataEdit=t,a.companyDataEditMaster=angular.copy(a.companyDataEdit),s()})}function C(a){p(a,function(a){i.overWriteCompanyData(a,function(a){r.checkSuccess(a),g()})})}function _(){a.companyDataEdit=angular.copy(a.companyDataEditMaster)}function v(){r.isAnythingSelected(a.selectedCompanies.id,function(t){r.confirmChange(t,function(t){i.changeContractStatus(t,function(t){r.checkSuccess(t),a.form.searchCompany.validContract&&a.form.searchCompany.expiredContract||(a.form.searchCompany.validContract=!a.form.searchCompany.validContract,a.form.searchCompany.expiredContract=!a.form.searchCompany.expiredContract),h(a.form.searchCompany)})})})}function D(){l(function(t){a.companyDataExtend=t,a.companyDataExtendMaster=angular.copy(a.companyDataExtend),d()})}function F(t){p(t,function(t){i.extendContract(t,function(t){r.checkSuccess(t),h(a.form.searchCompany)})})}function S(){a.companyDataExtend=angular.copy(a.companyDataExtendMaster)}function w(a){p(a,function(a){i.addNewCompany(a,function(a){r.checkSuccess(a)})})}function k(t){e.displayContent(a.display.form,t,function(t){a.display.form=t})}function A(){a.display=angular.copy(M)}a.display={form:{searchCompany:!1,sendEmail:!1,showDetails:!1,extendContract:!1,addNewCompany:!1},data:{list:!1,edit:!1,extend:!1}},a.form={searchCompany:{companyName:"",managerName:"",validContract:!0,expiredContract:!1,startingDate:null,endingDate:null,lastContractOnly:!0},addNewCompany:{company_name:"",starting_date:new Date,ending_date:new Date,company_phone:"",company_email:"",invoice_number:"",service_provider:"Zeller és Zeller Kft.",transfer_date:new Date,invoice_date:new Date,payment_method:"",account_number:"",price_of_serv_num:0,price_of_serv_let:"",company_address:"",company_register_id:"",company_tax_id:"",postal_number:"",postal_service:"nem",postal_name:"",postal_address:"",manager_name:"",manager_status:"ügyvezető",manager_id:"",manager_mother_name:"",manager_address:"",document_holder:"",document_holder_address:""}},a.filteredListOfCompanies=[],a.filteredListOfManagers=[],a.companyDataList=[],a.sortField="company_name",a.reverseSortField=!1,a.companyDataEdit=[],a.companyDataExtend=[],a.selectedCompanies={id:[],allChecked:!1};var M=angular.copy(a.display);a.companyDataEditMaster=[],a.companyDataExtendMaster=[],a.menu=k,a.reset=A,a.filterListOfCompanyNames=m,a.filterListOfManagerNames=f,a.insertCompanyNameToInputField=u,a.insertManagerNameToInputField=y,a.formGetCompanyDataList=h,a.formGetCompanyDataEdit=g,a.overwriteCompanyData=C,a.formChangeContractStatus=v,a.formGetCompanyDataExtend=D,a.addExtendedContract=F,a.addNewCompany=w,a.displayCompanyDataList=c,a.resetFormCompanyDataEdit=_,a.resetFormCompanyDataExtend=S}]);var DatabaseFactory=angular.module("DatabaseFactory",[]);DatabaseFactory.factory("Database",["$http",function(a){function t(t,e){a.post("php/companies/form_search_companies.php",t).success(function(a){e(a)})}function e(t,e){a.post("php/companies/form_companies_detailed.php",t).success(function(a){e(a)})}function n(t,e){a.post("php/companies/form_companies_overwrite_company_data.php",t).success(function(a){e(a)})}function o(t,e){a.post("php/companies/form_companies_change_contract_status.php",t).success(function(a){e(a)})}function r(t,e){a.post("php/companies/form_companies_extend_contract.php",t).success(function(a){e(a)})}function i(t,e){a.post("php/companies/form_companies_add_new_company.php",t).success(function(a){e(a)})}return{getShortCompaniesData:t,getDetailedCompaniesData:e,overWriteCompanyData:n,changeContractStatus:o,extendContract:r,addNewCompany:i}}]);var MailingCtrl=angular.module("MailingCtrl",[]);MailingCtrl.controller("MailingCtrl",["$scope","subMenu",function(a,t){function e(e){t.displayContent(a.display.form,e,function(t){a.display.form=t})}function n(){a.display=angular.copy(o)}a.display={form:{searchMails:!1,forwardMails:!1,editMails:!1,addNewMails:!1}};var o=angular.copy(a.display);a.menu=e,a.reset=n}]);var MailingFactory=angular.module("MailingFactory",[]);MailingFactory.factory("MailingFactory",["$http",function(a){}]);var SubMenuFactory=angular.module("SubMenuFactory",[]);SubMenuFactory.factory("SubMenu",[function(){function a(a,t,e){for(var n in a)n==t?a[n]=!0:a[n]=!1;e(a)}return{displayContent:a}}]);var FilteredSearchFactory=angular.module("FilteredSearchFactory",[]);FilteredSearchFactory.factory("FilteredSearch",["$http",function(a){function t(t){i?t(i):a.get("php/companies/fetch_company_names.php").success(function(a){i=a,t(a)})}function e(t){c?t(c):a.get("php/companies/fetch_manager_names.php").success(function(a){c=a,t(a)})}function n(a,t){var e=t,n=[];if(0!==a.length)for(var o=0;o<e.length;o++)e[o].substring(0,a.length).toLowerCase()===a.toLowerCase()&&n.push(e[o]);return n}function o(a,e){t(function(t){e(n(a,t))})}function r(a,t){e(function(e){t(n(a,e))})}var i,c;return{filterCompanyNames:o,filterManagerNames:r}}]);var FormatDataFactory=angular.module("FormatDataFactory",[]);FormatDataFactory.factory("FormatData",[function(){function a(a){var t=new Date(a);return t}function t(a){this.data=a}return t.prototype.addColourCoding=function(){return this.data.map(function(a){1!=a.contract_status||""!=a.postal_number&&null!=a.postal_number?1==a.contract_status?a.css_color="green":a.css_color="red":a.css_color="yellow"}),this},t.prototype.formatDateCorrectly=function(){return this.data.map(function(t){"1970-01-01"==t.starting_date||"0000-00-00"==t.starting_date||null==t.starting_date?t.starting_date=null:t.starting_date=a(t.starting_date),"1970-01-01"==t.ending_date||"0000-00-00"==t.ending_date||null==t.ending_date?t.ending_date=null:t.ending_date=a(t.ending_date),"1970-01-01"==t.transfer_date||"0000-00-00"==t.transfer_date||null==t.transfer_date?t.transfer_date=null:t.transfer_date=a(t.transfer_date),"1970-01-01"==t.invoice_date||"0000-00-00"==t.invoice_date||null==t.invoice_date?t.invoice_date=null:t.invoice_date=a(t.invoice_date)}),this},t.prototype.formatPostalServiceToString=function(){return this.data.map(function(a){1==a.postal_service?a.postal_service="igen":a.postal_service="nem"}),this},t.prototype.formatPostalServiceToBoolean=function(){return this.data.map(function(a){"igen"==a.postal_service?a.postal_service=1:a.postal_service=0}),this},{DataObject:t}}]);var AlertsFactory=angular.module("AlertsFactory",[]);AlertsFactory.factory("Alerts",[function(){function a(a,t){0==a.length?alert("Nem választottál ki semmit!"):t(a)}function t(a){1==a?alert("Változások sikeresen végrehajtva!"):alert("Nem sikerült a kért változatásokat végrehajtani!")}function e(a,t){var e=confirm("Végre akarod hajtani a kívánt változtatásokat?");e&&t(a)}return{isAnythingSelected:a,checkSuccess:t,confirmChange:e}}]);
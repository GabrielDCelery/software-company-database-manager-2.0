var DatabaseApp=angular.module("DatabaseApp",["ngRoute","ngCookies","checklist-model","AuthCtrl","AuthFactory","CompaniesCtrl","CompaniesFactory","MailingCtrl","MailingFactory","SubMenuFactory","FilteredSearchFactory"]);DatabaseApp.config(["$routeProvider","$locationProvider",function(e,t){e.when("/companies",{templateUrl:"templates/companies/_companies_main.html",controller:"CompaniesCtrl"}).when("/mailing",{templateUrl:"templates/mailing/_mailing_main.html",controller:"MailingCtrl"}).otherwise({redirectTo:"/"})}]);var AuthCtrl=angular.module("AuthCtrl",[]);AuthCtrl.controller("AuthCtrl",["$scope","AuthFactory",function(e,t){function a(a,n){t.login(a,n,function(o){o.data?(e.loggedIn=!0,t.setLoginCookie(a,n)):e.loggedIn=!1})}function n(){e.loggedIn=!1,t.clearLoginCookie()}function o(e){t.getLoginCookie(e)}e.loggedIn=!1,e.login=a,e.logout=n,o(a)}]);var AuthFactory=angular.module("AuthFactory",[]);AuthFactory.factory("AuthFactory",["$http","$cookies",function(e,t){function a(t,a,n){e.post("php/login.php",{username:t,password:a}).success(n)}function n(e,a){var n=i.encode(e),o=i.encode(a),r={username:n,password:o};t.putObject("userCookie",r)}function o(){t.remove("userCookie")}function r(e){var a=t.getObject("userCookie");if(a){var n=i.decode(a.username),o=i.decode(a.password);e(n,o)}}var i={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,a,n,o,r,i="",s="",c="",l=0;do t=e.charCodeAt(l++),a=e.charCodeAt(l++),s=e.charCodeAt(l++),n=t>>2,o=(3&t)<<4|a>>4,r=(15&a)<<2|s>>6,c=63&s,isNaN(a)?r=c=64:isNaN(s)&&(c=64),i=i+this.keyStr.charAt(n)+this.keyStr.charAt(o)+this.keyStr.charAt(r)+this.keyStr.charAt(c),t=a=s="",n=o=r=c="";while(l<e.length);return i},decode:function(e){var t,a,n,o,r,i="",s="",c="",l=0,u=/[^A-Za-z0-9\+\/\=]/g;u.exec(e)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=this.keyStr.indexOf(e.charAt(l++)),o=this.keyStr.indexOf(e.charAt(l++)),r=this.keyStr.indexOf(e.charAt(l++)),c=this.keyStr.indexOf(e.charAt(l++)),t=n<<2|o>>4,a=(15&o)<<4|r>>2,s=(3&r)<<6|c,i+=String.fromCharCode(t),64!=r&&(i+=String.fromCharCode(a)),64!=c&&(i+=String.fromCharCode(s)),t=a=s="",n=o=r=c="";while(l<e.length);return i}};return{login:a,setLoginCookie:n,clearLoginCookie:o,getLoginCookie:r}}]);var CompaniesCtrl=angular.module("CompaniesCtrl",[]);CompaniesCtrl.controller("CompaniesCtrl",["$scope","$http","subMenu","filteredSearch","CompaniesFunctions",function(e,t,a,n,o){function r(t){n.filterCompanyNames(t,function(t){e.filteredListOfCompanies=t})}function i(t){e.form.searchCompany.companyName=t,e.filteredListOfCompanies=[]}function s(t){n.filterManagerNames(t,function(t){e.filteredListOfManagers=t})}function c(t){e.form.searchCompany.managerName=t,e.filteredListOfManagers=[]}function l(){e.filteredListOfCompanies=[],e.filteredListOfManagers=[];var t=e.form.searchCompany;o.getShortCompaniesData(t,function(t){var a=new o.DataFormatter(t);a.addColourCoding(),e.companiesShortList=a.data})}function u(){if(0==e.selectedCompanies.id.length)alert("Nem választottál ki semmit!");else{var t=e.selectedCompanies;o.getDetailedCompaniesData(t,function(t){var a=new o.DataFormatter(t);a.addColourCoding().formatPostalServiceToString().formatDateCorrectly(),e.companiesDetailed=a.data,console.log(e.companiesDetailed)})}}function d(t){a.displayContent(e.display.form,t,function(t){e.display.form=t})}function p(){e.display=angular.copy(m)}e.display={form:{searchCompany:!1,sendEmail:!1,showDetails:!1,extendContract:!1,addNewCompany:!1},data:{"short":!0,detailed:!0}},e.form={searchCompany:{companyName:"",managerName:"",validContract:!0,expiredContract:!1,startingDate:null,endingDate:null,lastContractOnly:!0}},e.filteredListOfCompanies=[],e.filteredListOfManagers=[],e.companiesShortList=[],e.sortField="company_name",e.reverseSortField=!1,e.companiesDetailed=[],e.selectedCompanies={id:[],allChecked:!1};var m=angular.copy(e.display);e.menu=d,e.reset=p,e.filterListOfCompanyNames=r,e.filterListOfManagerNames=s,e.insertCompanyNameToInputField=i,e.insertManagerNameToInputField=c,e.formSearchCompaniesShortList=l,e.formGetDetailedCompaniesData=u}]);var CompaniesFactory=angular.module("CompaniesFactory",[]);CompaniesFactory.factory("CompaniesFunctions",["$http",function(e){function t(t,a){e.post("php/companies/form_search_companies.php",t).success(function(e){a(e)})}function a(t,a){e.post("php/companies/form_companies_detailed.php",t).success(function(e){a(e)})}function n(e){var t=new Date(e);return t}function o(e){this.data=e}return o.prototype.addColourCoding=function(){return this.data.map(function(e){1!=e.contract_status||""!=e.postal_number&&null!=e.postal_number?1==e.contract_status?e.css_color="green":e.css_color="red":e.css_color="yellow"}),this},o.prototype.formatDateCorrectly=function(){return this.data.map(function(e){"1970-01-01"==e.starting_date||"0000-00-00"==e.starting_date||null==e.starting_date?e.starting_date=null:e.starting_date=n(e.starting_date),"1970-01-01"==e.ending_date||"0000-00-00"==e.ending_date||null==e.ending_date?e.ending_date=null:e.ending_date=n(e.ending_date),"1970-01-01"==e.transfer_date||"0000-00-00"==e.transfer_date||null==e.transfer_date?e.transfer_date=null:e.transfer_date=n(e.transfer_date),"1970-01-01"==e.invoice_date||"0000-00-00"==e.invoice_date||null==e.invoice_date?e.invoice_date=null:e.invoice_date=n(e.invoice_date)}),this},o.prototype.formatPostalServiceToString=function(){return this.data.map(function(e){1==e.postal_service?e.postal_service="igen":e.postal_service="nem"}),this},{DataFormatter:o,getShortCompaniesData:t,getDetailedCompaniesData:a}}]);var MailingCtrl=angular.module("MailingCtrl",[]);MailingCtrl.controller("MailingCtrl",["$scope","subMenu",function(e,t){function a(a){t.displayContent(e.display.form,a,function(t){e.display.form=t})}function n(){e.display=angular.copy(o)}e.display={form:{searchMails:!1,forwardMails:!1,editMails:!1,addNewMails:!1}};var o=angular.copy(e.display);e.menu=a,e.reset=n}]);var MailingFactory=angular.module("MailingFactory",[]);MailingFactory.factory("MailingFactory",["$http",function(e){}]);var SubMenuFactory=angular.module("SubMenuFactory",[]);SubMenuFactory.factory("subMenu",[function(){function e(e,t,a){for(var n in e)n==t?e[n]=!0:e[n]=!1;a(e)}return{displayContent:e}}]);var FilteredSearchFactory=angular.module("FilteredSearchFactory",[]);FilteredSearchFactory.factory("filteredSearch",["$http",function(e){function t(t){i?t(i):e.get("php/companies/fetch_company_names.php").success(function(e){i=e,t(e)})}function a(t){s?t(s):e.get("php/companies/fetch_manager_names.php").success(function(e){s=e,t(e)})}function n(e,t){var a=t,n=[];if(0!==e.length)for(var o=0;o<a.length;o++)a[o].substring(0,e.length).toLowerCase()===e.toLowerCase()&&n.push(a[o]);return n}function o(e,a){t(function(t){a(n(e,t))})}function r(e,t){a(function(a){t(n(e,a))})}var i,s;return{filterCompanyNames:o,filterManagerNames:r}}]);